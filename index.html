<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Roadmap de Produtos - Visual 2.0 Corrigido</title>
  <style>
    :root {
      --bg: #0e1a2b;
      --text: #e1e8f0;
      --linha: #1c2d44;
      --borda: #324056;
      --cores: #6ec1e4, #f6c979, #82d173, #ff92b1;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      padding: 24px;
    }

    h1 {
      text-align: center;
      margin-bottom: 24px;
      font-size: 24px;
    }

    .filtros {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    label {
      font-size: 14px;
    }

    select {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      background-color: #1b2c47;
      color: var(--text);
    }

    .roadmap {
      position: relative;
      width: 100%;
      overflow-x: auto;
      border: 1px solid var(--borda);
    }

    .grid {
      display: grid;
      grid-template-columns: 200px repeat(36, 1fr);
    }

    .cell {
      height: 40px;
      border-left: 1px solid var(--borda);
      border-bottom: 1px solid var(--borda);
    }

    .cat-header {
      grid-column: span 37;
      background-color: #223651;
      font-weight: bold;
      padding: 8px 12px;
      border-bottom: 1px solid var(--borda);
    }

    .nome-entrega {
      background-color: var(--linha);
      padding: 10px;
      font-weight: 500;
      border-bottom: 1px solid var(--borda);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mes-label {
      text-align: center;
      font-size: 12px;
      background-color: #15263d;
      padding: 4px;
      border-left: 1px solid var(--borda);
      border-bottom: 1px solid var(--borda);
    }

    .barra {
      position: absolute;
      height: 28px;
      border-radius: 6px;
      padding: 4px 8px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #000;
    }
  </style>
</head>
<body>
  <h1>Roadmap de Produtos - Plataforma (Visual 2.0)</h1>

  <div class="filtros">
    <label>Categoria:
      <select id="filtroCategoria">
        <option value="">Todas</option>
      </select>
    </label>
    <label>Ano:
      <select id="filtroAno">
        <option value="">Todos os anos</option>
      </select>
    </label>
  </div>

  <div class="roadmap">
    <div id="grid" class="grid"></div>
  </div>

  <script>
    const entregas = [
      {Entrega: "Múltiplas adquirentes", Fase: "Discovery", Inicio: "2024-01", Fim: "2025-12"},
      {Entrega: "Pix automático", Fase: "Discovery", Inicio: "2024-01", Fim: "2025-06"},
      {Entrega: "Unificação Navision", Fase: "Discovery", Inicio: "2025-04", Fim: "2025-12"},
      {Entrega: "Unificação Salesforce", Fase: "Discovery", Inicio: "2025-04", Fim: "2025-12"},
      {Entrega: "FCV Salesforce", Fase: "Discovery", Inicio: "2025-04", Fim: "2025-06"},
      {Entrega: "Adoção B2C", Fase: "Refinamento", Inicio: "2024-01", Fim: "2025-12"},
      {Entrega: "Backoffice Plataforma", Fase: "Refinamento", Inicio: "2024-01", Fim: "2025-12"},
      {Entrega: "Projeto redução de perdas", Fase: "Refinamento", Inicio: "2024-01", Fim: "2025-09"},
      {Entrega: "Redução de cancelamentos B2B", Fase: "Refinamento", Inicio: "2025-04", Fim: "2025-09"},
      {Entrega: "Analytics B2C", Fase: "Finalizado", Inicio: "2025-03", Fim: "2025-03"},
      {Entrega: "Adoção B2B", Fase: "Finalizado", Inicio: "2024-01", Fim: "2025-03"},
      {Entrega: "PCI 2025", Fase: "Finalizado", Inicio: "2025-04", Fim: "2025-06"}
    ];

    const categorias = [...new Set(entregas.map(e => e.Fase))];
    const anos = [2023, 2024, 2025];
    const cores = ["#6ec1e4", "#f6c979", "#82d173", "#ff92b1"];

    const filtroCategoria = document.getElementById("filtroCategoria");
    const filtroAno = document.getElementById("filtroAno");
    const grid = document.getElementById("grid");

    categorias.forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat;
      filtroCategoria.appendChild(opt);
    });

    anos.forEach(ano => {
      const opt = document.createElement("option");
      opt.value = ano;
      opt.textContent = ano;
      filtroAno.appendChild(opt);
    });

    function render() {
      grid.innerHTML = "";
      // Cabeçalho
      grid.innerHTML += `<div class='nome-entrega'></div>`;
      for (let y of anos) {
        for (let m = 0; m < 12; m++) {
          const nome = new Date(y, m).toLocaleString("pt-BR", { month: "short" });
          grid.innerHTML += `<div class='mes-label'>${nome}/${y}</div>`;
        }
      }

      let row = 0;
      let corIndex = 0;
      categorias.forEach(cat => {
        const cor = cores[corIndex++ % cores.length];
        const blocos = entregas.filter(e => e.Fase === cat)
          .filter(e => !filtroCategoria.value || filtroCategoria.value === e.Fase)
          .filter(e => !filtroAno.value || e.Inicio.startsWith(filtroAno.value) || e.Fim.startsWith(filtroAno.value));

        if (blocos.length === 0) return;

        const header = document.createElement("div");
        header.className = "cat-header";
        header.textContent = cat;
        grid.appendChild(header);
        for (let i = 0; i < 36; i++) grid.appendChild(document.createElement("div"));

        blocos.forEach(e => {
          grid.innerHTML += `<div class='nome-entrega'>${e.Entrega}</div>`;
          for (let i = 0; i < 36; i++) grid.innerHTML += `<div class='cell'></div>`;

          const ini = (parseInt(e.Inicio.slice(0,4)) - 2023) * 12 + (parseInt(e.Inicio.slice(5,7)) - 1);
          const fim = (parseInt(e.Fim.slice(0,4)) - 2023) * 12 + (parseInt(e.Fim.slice(5,7)) - 1);

          const barra = document.createElement("div");
          barra.className = "barra";
          barra.textContent = e.Entrega;
          barra.style.background = cor;
          barra.style.left = `calc(200px + ${(ini) * (100 / 36)}%)`;
          barra.style.width = `calc(${(fim - ini + 1) * (100 / 36)}% - 4px)`;
          barra.style.top = `${72 + 40 * row}px`;
          grid.appendChild(barra);

          row++;
        });
      });
    }

    filtroCategoria.addEventListener("change", render);
    filtroAno.addEventListener("change", render);
    render();
  </script>
</body>
</html>
